#!/bin/bash

set +u

if [[ $BUILDKITE_LABEL =~ ":selenium:" ]];
then
  echo "--- :twisted_rightwards_arrows::desktop_computer: Downloading build artifacts"
  buildkite-agent artifact download "dist.tar.zst" .
  buildkite-agent artifact download "web.tar.zst" .
  echo "--- :go::node: Extracting build artifacts"
  tar xf dist.tar.zst
  tar xf web.tar.zst
fi

if [[ $BUILDKITE_LABEL =~ ":docker: Deploy Image" ]];
then
  buildkite-agent artifact download "authelia-image-${ARCH}*" .
  zstdcat authelia-image-"${ARCH}".tar.zst | docker load
fi

if [[ $BUILDKITE_LABEL == ":github: Deploy Artifacts" ]];
then
  buildkite-agent artifact download "authelia-linux-*" .
fi