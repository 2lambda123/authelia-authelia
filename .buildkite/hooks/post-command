#!/bin/bash

set +u

DOCKER_IMAGE=nightah/authelia

if [[ $BUILDKITE_LABEL =~ ":selenium:" ]];
then
  CONTAINERS=$(docker ps -a -q)
  if [[ $CONTAINERS != "" ]];
  then
    echo "--- :docker: Clean environment"
    docker rm -f $(docker ps -a -q)
  fi
fi

if [[ $BUILDKITE_LABEL =~ ":docker: Build Image" ]];
then
  echo "--- :docker: Saving images for push to DockerHub"
  docker save $DOCKER_IMAGE | gzip > authelia-image-$ARCH.tar.gz
fi